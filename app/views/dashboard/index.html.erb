<% content_for :head do %>
Dashboard
<% end %>

<div class="dashboard">
    <% if @budgets.empty? %>
    <h2>You don't have any budgets yet. Get started by
        <%= link_to "making one now", new_budget_path %>
    </h2>
    <% end %>
    <% @budgets.each do |budget| %>
    <%  
          @budget = budget
          @incomes = Income.where(budget: @budget) 
          @expenses = Expense.where(budget: @budget) 
          %>

    <div class="uk-width-small-1-1">
        <h1 class="dashboard-header">
            Budget: <%= @budget.name %>
        </h1>
    </div>
    <section class="page-section" style="min-height:100px;">
        <div class="uk-width-small-8-10 uk-container-center uk-grid">
            <div class="uk-width-small-1-1">
                <div class="uk-width-small-1-3 uk-container-center uk-text-center">
                    <h2 >
                        Total Daily Allowance:
                    </h2>
                    <p>
                        to reach the savings goal of
                        <%= number_to_currency(@budget.planned_savings) %></p>
                </div>
            </div>
            <div class="uk-width-small-1-1">
                <div class="uk-width-small-1-2 uk-container-center">
                    <hr class="line-break"/>
                </div>
            </div>
        </section>
        <section class="page-section">
            <div class="uk-width-small-1-6 uk-vertical-align">
                <h2 class="uk-vertical-align-middle">
                    Quick Look
                </h2>
            </div>
            <div class="uk-width-small-1-4 uk-grid">
                <div class="uk-width-small-1-2  uk-text-center">
                  
                  <% if @expenses.empty? %>
                  <h3> 
                    <%= link_to "Add some expenses", edit_budget_path(@budget) %> to see the breakdown 
                  </h3>
                  <% else %> 
                    <%= pie_chart @expenses.group(:category).count, legend: false, height: "100px" %>
                    <p>Expense Categories</p>
                    <% end %>
                </div>
                <div class="uk-width-small-1-2  uk-text-center">
                  <% if @incomes.empty? %>
                  <h3> 
                    <%= link_to "Add some incomes", edit_budget_path(@budget) %> to see the breakdown 
                  </h3>
                  <% else %> 
                    <%= pie_chart @incomes.group(:category).count, legend: false, height: "100px" %>
                    <p>Income Categories</p>
                    <% end %>
                </div>
            </div>
        </div>
    </section>
    <% end %>
</div>